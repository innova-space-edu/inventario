<!DOCTYPE html> 
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Inventario - Laboratorio de Ciencias</title>

  <!-- Estilos originales -->
  <link rel="stylesheet" href="/css/styles.css" />
  <!-- Fondo espacial + glass UI -->
  <link rel="stylesheet" href="/css/app.css" />

  <!-- Utilidades compartidas de personas (Biblioteca + Ciencias) -->
  <script defer src="/js/peopleUtils.js"></script>

  <!-- JS específico de Ciencias -->
  <script defer src="/js/science.js"></script>
</head>

<body data-page="science" class="body-space">
  <!-- Fondo espacial animado -->
  <div class="background space-bg"></div>

  <div class="app-shell">
    <div class="glass-panel">
      <header>
        <h1>Laboratorio de Ciencias</h1>
        <nav>
          <a href="/">Inicio</a>
        </nav>
      </header>

      <!-- =========================
           SECCIÓN: INVENTARIO
      ========================== -->
      <section class="form-section">
        <h2>Agregar / Editar material de laboratorio</h2>

        <form id="scienceForm" enctype="multipart/form-data" method="post">
          <!-- id oculto para modo edición -->
          <input type="hidden" name="id" id="sciId" />

          <label for="sciCode">Código:</label>
          <input
            type="text"
            name="codigo"
            id="sciCode"
            required
            data-message="Ingresa el código interno del material de laboratorio."
          />

          <label for="sciName">Nombre del material:</label>
          <input
            type="text"
            name="nombre"
            id="sciName"
            required
            data-message="Escribe el nombre del material, por ejemplo: probeta de 100 mililitros."
          />

          <label for="sciDescription">Descripción:</label>
          <textarea
            name="descripcion"
            id="sciDescription"
            required
            data-message="Describe brevemente el material, su uso o sus características principales."
          ></textarea>

          <label for="sciCategory">Categoría:</label>
          <select
            id="sciCategory"
            name="categoria"
            required
            data-message="Selecciona el tipo de material: instrumento, químico, biológico, seguridad u otro."
          >
            <option value="instrumento">Instrumento de laboratorio</option>
            <option value="material químico">Material químico</option>
            <option value="material biológico">Material biológico</option>
            <option value="instrumento electrónico">Instrumento electrónico</option>
            <option value="modelo didáctico">Modelo didáctico / maqueta</option>
            <option value="seguridad">Elemento de seguridad</option>
            <option value="otros">Otros</option>
          </select>

          <label for="sciQuantity">Cantidad:</label>
          <input
            type="number"
            name="cantidad"
            id="sciQuantity"
            required
            data-message="Indica la cantidad de unidades de este material que se incorporan al inventario."
          />

          <label for="sciDate">Fecha de ingreso:</label>
          <input
            type="date"
            name="fecha"
            id="sciDate"
            required
            data-message="Selecciona la fecha de ingreso del material al laboratorio."
          />

          <label for="sciPhoto">Fotografía:</label>
          <input
            type="file"
            id="sciPhoto"
            name="photo"
            accept="image/*"
            data-message="Opcional: agrega una fotografía del material para identificarlo visualmente."
          />

          <div style="display:flex; gap:.75rem; margin-top:1rem;">
            <button
              type="submit"
              id="scienceFormSubmit"
              class="button"
              data-message="Guardar o actualizar este material en el inventario del laboratorio de ciencias."
            >
              Guardar
            </button>
            <button
              type="button"
              id="scienceFormCancelEdit"
              class="button secondary"
              style="display:none;"
              data-message="Cancelar la edición actual y volver al modo de registro normal."
            >
              Cancelar edición
            </button>
          </div>
        </form>
      </section>

      <section class="inventory-section">
        <h2>Inventario general de Ciencias</h2>

        <div class="filters-bar">
          <input
            type="text"
            id="scienceSearch"
            placeholder="Buscar por código, nombre, descripción..."
            class="input-search"
            data-message="Escribe aquí para filtrar el inventario por código, nombre o descripción."
          />
        </div>

        <table id="scienceTable">
          <thead>
            <tr>
              <th>ID</th>
              <th>Código</th>
              <th>Nombre</th>
              <th>Descripción</th>
              <th>Categoría</th>
              <th>Cantidad</th>
              <th>Fecha</th>
              <th>Foto</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="scienceTableBody">
            <!-- Elementos cargados dinámicamente -->
          </tbody>
        </table>
      </section>

      <!-- =========================
           SECCIÓN: PRÉSTAMOS
      ========================== -->
      <section class="loans-section">
        <h2>Registrar préstamo</h2>

        <form id="scienceLoanForm">
          <label for="sciLoanCodigo">Código del material:</label>
          <input
            type="text"
            id="sciLoanCodigo"
            name="codigo"
            required
            data-message="Ingresa el código del material de ciencias que se va a prestar."
          />

          <!-- Selector de persona (compartido con Biblioteca) -->
          <label for="sciLoanPersonSelect">Persona (desde listado):</label>
          <select
            id="sciLoanPersonSelect"
            name="personaId"
            class="persona-select"
            data-curso-target="sciLoanCurso"
            data-message="Selecciona a la persona desde el listado de estudiantes o funcionarios."
          >
            <option value="">-- Seleccionar desde lista --</option>
          </select>

          <label for="sciLoanNombre">Nombre:</label>
          <input
            type="text"
            id="sciLoanNombre"
            name="nombre"
            required
            data-message="Escribe el nombre de la persona que recibe el material, si no aparece en la lista."
          />

          <label for="sciLoanCurso">Curso / Unidad:</label>
          <input
            type="text"
            id="sciLoanCurso"
            name="curso"
            data-message="Indica el curso o unidad, por ejemplo: 2° medio B o Departamento de Ciencias."
          />

          <label for="sciLoanTipoPersona">Tipo de persona:</label>
          <input
            type="text"
            id="sciLoanTipoPersona"
            name="tipoPersona"
            placeholder="estudiante / funcionario"
            data-message="Especifica si la persona es estudiante, funcionario u otro tipo."
          />

          <label for="sciLoanObservaciones">Observaciones:</label>
          <input
            type="text"
            id="sciLoanObservaciones"
            name="observaciones"
            placeholder="Opcional"
            data-message="Puedes escribir observaciones del préstamo, como condiciones especiales o usos."
          />

          <button
            type="submit"
            class="button"
            data-message="Registrar este préstamo en el sistema del laboratorio de ciencias."
          >
            Registrar préstamo
          </button>
        </form>

        <!-- Cuadro de devolución rápida por ID -->
        <form id="scienceReturnForm" style="margin-top: 1rem;">
          <h3>Registrar devolución</h3>
          <label for="scienceReturnId">ID del préstamo:</label>
          <input
            type="text"
            id="scienceReturnId"
            name="loanId"
            placeholder="Ej: 17640888254868"
            required
            data-message="Escribe el ID del préstamo que deseas marcar como devuelto."
          />
          <button
            type="submit"
            class="button"
            data-message="Registrar la devolución de este préstamo."
          >
            Registrar devolución
          </button>
        </form>

        <div class="filters-bar" style="margin-top: 1.5rem;">
          <input
            type="text"
            id="scienceLoansSearch"
            placeholder="Buscar préstamo por ID, nombre, código, curso..."
            class="input-search"
            data-message="Filtra los préstamos por ID, nombre, código de material o curso."
          />
        </div>

        <h3>Préstamos</h3>
        <table id="scienceLoansTable">
          <thead>
            <tr>
              <th>ID</th>
              <th>Código</th>
              <th>Nombre</th>
              <th>Curso</th>
              <th>Fecha</th>
              <th>Devuelto</th>
              <th>Devuelto el</th>
              <th>Observaciones</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="scienceLoansTableBody">
            <!-- Carga dinámica JS -->
          </tbody>
        </table>
      </section>

      <!-- =========================
           SECCIÓN: PERSONAS
           (solo lectura, compartidas con Biblioteca)
      ========================== -->
      <section class="people-section">
        <h2>Personas registradas</h2>
        <p class="hint-text">
          Este listado se comparte con Biblioteca. Para agregar o editar
          estudiantes/funcionarios, utiliza el módulo de <b>Biblioteca</b>.
        </p>

        <table id="sciencePeopleTable">
          <thead>
            <tr>
              <th>ID</th>
              <th>Nombre</th>
              <th>Tipo</th>
              <th>Curso / Cargo</th>
            </tr>
          </thead>
          <tbody>
            <!-- Carga dinámica JS -->
          </tbody>
        </table>
      </section>

      <footer>
        <p>© 2025 Innova Space Education - Laboratorio de Ciencias</p>
      </footer>
    </div>
  </div>

  <!-- Scripts generales -->
  <script src="/js/script.js"></script>
  <script src="/js/roleGuard.js"></script>
</body>
</html>
