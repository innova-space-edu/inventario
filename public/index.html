<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Inventario ‚Äì Colegio Providencia</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Sugerencia: preconnect para fonts (si usas Google Fonts en tu CSS) -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

  <!-- CSS principal -->
  <link rel="stylesheet" href="/css/app.css" />

  <!-- Librer√≠as para exportar: PDF / XLSX -->
  <!-- (Las usaremos desde /js/history.js o /js/reports.js) -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <!-- Chart.js (para analytics) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>

<body class="body-space" data-page="dashboard">
  <!-- Fondo espacial + contenedor para estrellas (lo llena /script.js) -->
  <div class="background space-bg" aria-hidden="true"></div>

  <div class="app-shell">
    <!-- HEADER con logo y bot√≥n Agendar hora -->
    <header class="main-header glass-panel">
      <div class="header-left">
        <img
          src="/img/logo-colegio.png"
          alt="Logo Colegio Providencia"
          class="header-logo"
          loading="lazy"
          decoding="async"
        />
        <div class="header-title">
          <h1>Inventario Colegio Providencia</h1>
          <span class="header-subtitle">Innova Space Track</span>
        </div>
      </div>

      <nav class="header-right" aria-label="Acciones principales">
        <a
          href="https://sites.google.com/colprovidencia.cl/agenda-hora/inicio"
          class="btn-secondary"
          target="_blank"
          rel="noopener noreferrer"
        >
          Agendar hora
        </a>

        <form action="/logout" method="get" class="logout-form">
          <button type="submit" class="btn-ghost">Cerrar sesi√≥n</button>
        </form>
      </nav>
    </header>

    <!-- NAV de secciones -->
    <nav class="tabs glass-panel" aria-label="M√≥dulos de inventario">
      <button class="tab-button active" type="button" data-target="#tab-science">Laboratorio de Ciencias</button>
      <button class="tab-button" type="button" data-target="#tab-computing">Sala de Computaci√≥n</button>
      <button class="tab-button" type="button" data-target="#tab-library">Biblioteca</button>
      <button class="tab-button" type="button" data-target="#tab-reservations">Reservas</button>
      <button class="tab-button" type="button" data-target="#tab-history">Historial + Reportes</button>
    </nav>

    <!-- CONTENIDO PRINCIPAL -->
    <main class="main-content">

      <!-- SCIENCE -->
      <section id="tab-science" class="tab-panel active glass-panel" role="region" aria-label="Laboratorio de Ciencias">
        <h2>Inventario ‚Äì Laboratorio de Ciencias</h2>
        <p class="section-description">
          Registra materiales de laboratorio, controla stock autom√°ticamente con pr√©stamos/devoluciones y genera reservas.
        </p>

        <div class="panel-grid">
          <!-- Formulario de ingreso -->
          <div class="panel-block">
            <div class="collapsible-card" data-collapsed="true">
              <div class="collapsible-header">
                <h3>Agregar material de ciencias</h3>
                <button type="button" class="collapse-toggle" aria-expanded="false">
                  <span class="collapse-icon">‚åÑ</span> Mostrar
                </button>
              </div>

              <div class="collapsible-body">
                <form id="scienceForm" enctype="multipart/form-data">
                  <div class="form-grid">
                    <label>
                      C√≥digo
                      <input type="text" name="codigo" required />
                    </label>

                    <label>
                      Nombre
                      <input type="text" name="nombre" required />
                    </label>

                    <label>
                      Descripci√≥n
                      <input type="text" name="descripcion" />
                    </label>

                    <label>
                      Categor√≠a
                      <select name="categoria" required>
                        <option value="instrumento">Instrumento de Laboratorio</option>
                        <option value="material qu√≠mico">Material Qu√≠mico</option>
                        <option value="material biol√≥gico">Material Biol√≥gico</option>
                        <option value="instrumento electr√≥nico">Instrumento Electr√≥nico</option>
                        <option value="modelo educativo">Modelo o Material Did√°ctico</option>
                        <option value="seguridad">Elemento de Seguridad</option>
                        <option value="otro">Otro</option>
                      </select>
                    </label>

                    <label>
                      Cantidad (stock inicial)
                      <input type="number" name="cantidad" min="0" required />
                    </label>

                    <label>
                      Fecha de ingreso
                      <input type="date" name="fecha" required />
                    </label>

                    <label>
                      Foto
                      <input type="file" name="photo" accept="image/*" />
                    </label>
                  </div>

                  <button type="submit" class="btn-primary">Guardar material</button>
                </form>
              </div>
            </div>
          </div>

          <!-- Tabla de elementos -->
          <div class="panel-block">
            <div class="collapsible-card" data-collapsed="true">
              <div class="collapsible-header">
                <h3>Listado de materiales</h3>
                <button type="button" class="collapse-toggle" aria-expanded="false">
                  <span class="collapse-icon">‚åÑ</span> Mostrar
                </button>
              </div>

              <div class="collapsible-body">
                <div class="table-wrapper">
                  <table id="scienceTable" class="inventory-table">
                    <thead>
                      <tr>
                        <th>ID</th>
                        <th>C√≥digo</th>
                        <th>Nombre</th>
                        <th>Descripci√≥n</th>
                        <th>Categor√≠a</th>
                        <th>Stock</th>
                        <th>Fecha</th>
                        <th>Foto</th>
                        <th>Acciones</th>
                      </tr>
                    </thead>
                    <tbody>
                      <!-- science.js llenar√° aqu√≠ -->
                    </tbody>
                  </table>
                </div>

                <p class="section-description" style="margin-top:12px;">
                  ‚úÖ El stock se actualiza autom√°ticamente cuando registras <strong>pr√©stamos</strong> y <strong>devoluciones</strong>.
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Reserva de laboratorio ciencias -->
        <div class="panel-grid">
          <div class="panel-block">
            <div class="collapsible-card" data-collapsed="true">
              <div class="collapsible-header">
                <h3>Reserva de laboratorio de ciencias</h3>
                <button type="button" class="collapse-toggle" aria-expanded="false">
                  <span class="collapse-icon">‚åÑ</span> Mostrar
                </button>
              </div>

              <div class="collapsible-body">
                <form id="scienceReservationForm">
                  <div class="form-grid">
                    <label>
                      Nombre del solicitante
                      <input type="text" name="solicitante" required />
                    </label>

                    <label>
                      Curso
                      <input type="text" name="curso" required />
                    </label>

                    <label>
                      Fecha de uso
                      <input type="date" name="fechaUso" required />
                    </label>

                    <label>
                      Hora inicio
                      <input type="time" name="horaInicio" required />
                    </label>

                    <label>
                      Hora t√©rmino
                      <input type="time" name="horaTermino" required />
                    </label>

                    <label class="full-width">
                      Recursos / materiales (opcional)
                      <input type="text" name="recursos" placeholder="Ej: microscopio x2, vasos precipitados x10..." />
                    </label>

                    <label class="full-width">
                      Observaciones
                      <input type="text" name="observaciones" />
                    </label>
                  </div>

                  <div class="form-actions">
                    <button type="submit" class="btn-secondary">Registrar reserva</button>
                    <span class="mini-hint">‚úÖ Validaci√≥n anti-choques: no permite misma fecha/horario superpuesto.</span>
                  </div>
                </form>

                <div id="scienceReservationStatus" class="info-box" style="margin-top:12px; display:none;"></div>
              </div>
            </div>
          </div>

          <!-- Pr√©stamo / devoluci√≥n (Ciencias) -->
          <div class="panel-block">
            <div class="collapsible-card" data-collapsed="true" id="science-loans-card">
              <div class="collapsible-header">
                <h3>Pr√©stamos / devoluciones (Ciencias)</h3>
                <button type="button" class="collapse-toggle" aria-expanded="false">
                  <span class="collapse-icon">‚åÑ</span> Mostrar
                </button>
              </div>

              <div class="collapsible-body">
                <form id="scienceLoanForm" class="form-grid">
                  <div class="form-grid">
                    <label>
                      ID / C√≥digo del material
                      <input type="text" id="scienceLoanItemId" name="itemId" placeholder="ID o c√≥digo" required />
                    </label>

                    <label>
                      Cantidad a prestar
                      <input type="number" id="scienceLoanQty" name="cantidad" min="1" value="1" required />
                    </label>

                    <label>
                      Tipo de persona
                      <select id="scienceLoanTipoPersona" name="tipoPersona" required>
                        <option value="" selected disabled>Seleccione tipo</option>
                        <option value="estudiante">Estudiante</option>
                        <option value="funcionario">Funcionario</option>
                      </select>
                    </label>
                  </div>

                  <div class="form-grid">
                    <label>
                      Persona
                      <input type="text" id="scienceLoanUser" name="persona" placeholder="Nombre completo" required />
                    </label>

                    <label>
                      Curso / Grupo
                      <input type="text" id="scienceLoanCurso" name="curso" placeholder="Ej: 3¬∞B, UTP, Taller..." />
                    </label>
                  </div>

                  <div class="form-grid">
                    <label class="full-width">
                      Observaciones
                      <input type="text" id="scienceLoanObs" name="observaciones" placeholder="Ej: pr√°ctica de qu√≠mica, gu√≠a 2..." />
                    </label>
                  </div>

                  <div class="form-actions">
                    <button type="submit" class="btn-secondary">Registrar pr√©stamo</button>
                    <button type="button" class="btn-ghost" id="btnScienceReturn" title="Registrar devoluci√≥n por ID de pr√©stamo">
                      Registrar devoluci√≥n
                    </button>
                  </div>

                  <div id="scienceLoanItemInfo" class="info-box" style="margin-top:10px; display:block;">
                    Escribe el <strong>ID</strong> o <strong>c√≥digo</strong> para validar stock y mostrar detalle antes de prestar.
                  </div>

                  <div id="scienceReturnInline" class="subbox" style="display:none; margin-top:12px;">
                    <h4>Devoluci√≥n (Ciencias)</h4>
                    <div class="form-grid">
                      <label>
                        ID del pr√©stamo
                        <input type="text" id="scienceReturnLoanId" placeholder="Ej: 1021" />
                      </label>
                      <label>
                        Cantidad a devolver (opcional)
                        <input type="number" id="scienceReturnQty" min="1" placeholder="Si aplica" />
                      </label>
                    </div>
                    <div class="form-actions">
                      <button type="button" id="scienceReturnSubmit" class="btn-primary">Confirmar devoluci√≥n</button>
                      <button type="button" id="scienceReturnCancel" class="btn-ghost">Cancelar</button>
                    </div>
                  </div>
                </form>

                <div class="table-wrapper" style="margin-top:14px;">
                  <table id="scienceLoanTable" class="inventory-table">
                    <thead>
                      <tr>
                        <th>ID</th>
                        <th>ID Material</th>
                        <th>C√≥digo</th>
                        <th>Cantidad</th>
                        <th>Tipo persona</th>
                        <th>Persona</th>
                        <th>Curso / Grupo</th>
                        <th>Fecha pr√©stamo</th>
                        <th>Fecha devoluci√≥n</th>
                        <th>Devuelto</th>
                        <th>Acciones</th>
                      </tr>
                    </thead>
                    <tbody id="scienceLoanTableBody">
                      <!-- science.js llenar√° aqu√≠ -->
                    </tbody>
                  </table>
                </div>

                <div class="panel-grid" style="margin-top:14px;">
                  <div class="panel-block">
                    <div class="info-box">
                      <strong>‚ö†Ô∏è Vencidos (+7 d√≠as):</strong>
                      <ul id="scienceOverdueList" class="list-container" style="margin-top:8px;"></ul>
                    </div>
                  </div>
                  <div class="panel-block">
                    <div class="info-box">
                      <strong>üìå Pendientes por devolver:</strong>
                      <ul id="scienceDebtorsList" class="list-container" style="margin-top:8px;"></ul>
                    </div>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- COMPUTING -->
      <section id="tab-computing" class="tab-panel glass-panel" role="region" aria-label="Sala de Computaci√≥n">
        <h2>Inventario ‚Äì Sala de Computaci√≥n</h2>
        <p class="section-description">
          Controla equipos, perif√©ricos, software y pr√©stamos con stock autom√°tico + alertas por atraso.
        </p>

        <!-- 1) FORMULARIO INVENTARIO COMPUTACI√ìN -->
        <div class="panel-grid">
          <div class="panel-block">
            <div class="collapsible-card" data-collapsed="true">
              <div class="collapsible-header">
                <h3>Registrar equipo / software / activo</h3>
                <button type="button" class="collapse-toggle" aria-expanded="false">
                  <span class="collapse-icon">‚åÑ</span> Mostrar
                </button>
              </div>

              <div class="collapsible-body">
                <form id="computingForm" class="card" enctype="multipart/form-data">
                  <div class="form-grid">
                    <div class="form-group">
                      <label for="compIdEquip">ID equipo / etiqueta interna</label>
                      <input type="text" id="compIdEquip" name="idEquip" placeholder="Ej: PC-001" />
                    </div>

                    <div class="form-group">
                      <label for="compCodigo">C√≥digo inventario / c√≥digo barra</label>
                      <input type="text" id="compCodigo" name="codigo" placeholder="Ej: INV-2025-001" required />
                    </div>

                    <div class="form-group">
                      <label for="compMarca">Marca</label>
                      <input type="text" id="compMarca" name="marca" placeholder="Ej: HP, Dell, Lenovo..." />
                    </div>

                    <div class="form-group">
                      <label for="compModelo">Modelo</label>
                      <input type="text" id="compModelo" name="modelo" placeholder="Ej: EliteDesk 800 G3" />
                    </div>

                    <div class="form-group">
                      <label for="compSerie">N¬∞ de serie</label>
                      <input type="text" id="compSerie" name="serie" placeholder="Serie del fabricante" />
                    </div>

                    <div class="form-group">
                      <label for="compCantidad">Cantidad (stock)</label>
                      <input type="number" id="compCantidad" name="cantidad" min="1" step="1" value="1" required />
                    </div>

                    <div class="form-group">
                      <label for="compEstado">Estado</label>
                      <select id="compEstado" name="estado">
                        <option value="">Seleccionar...</option>
                        <option value="operativo">Operativo</option>
                        <option value="en_reparacion">En reparaci√≥n</option>
                        <option value="dado_de_baja">Dado de baja</option>
                      </select>
                    </div>

                    <div class="form-group">
                      <label for="compFechaCompra">Fecha de compra</label>
                      <input type="date" id="compFechaCompra" name="fechaCompra" />
                    </div>
                  </div>

                  <hr />

                  <h3>Clasificaci√≥n del activo</h3>
                  <div class="form-grid">
                    <div class="form-group">
                      <label for="compTipoActivo">Tipo de activo</label>
                      <select id="compTipoActivo" name="tipoActivo">
                        <option value="">Seleccionar...</option>
                        <option value="hardware">Hardware</option>
                        <option value="software">Software</option>
                        <option value="otros-activos">Otros activos</option>
                      </select>
                    </div>

                    <div class="form-group">
                      <label for="compSubtipo">Subtipo</label>
                      <select id="compSubtipo" name="subtipo">
                        <option value="">Seleccionar...</option>
                        <option value="computadoras">Computadoras</option>
                        <option value="perifericos">Perif√©ricos</option>
                        <option value="dispositivos-red">Dispositivos de red</option>
                        <option value="sistemas-operativos">Sistemas operativos</option>
                        <option value="aplicaciones">Aplicaciones</option>
                        <option value="licencias">Licencias</option>
                        <option value="mobiliario">Mobiliario</option>
                        <option value="herramientas">Herramientas / otros</option>
                      </select>
                    </div>

                    <div class="form-group">
                      <label for="compDetalleTipo">Detalle tipo (ej: PC escritorio, switch, mesa)</label>
                      <input type="text" id="compDetalleTipo" name="detalleTipo" />
                    </div>

                    <div class="form-group">
                      <label for="compUbicacion">Ubicaci√≥n</label>
                      <input type="text" id="compUbicacion" name="ubicacion" placeholder="Ej: Sala de computaci√≥n, Laboratorio 1, Bodega..." />
                    </div>

                    <div class="form-group">
                      <label for="compFechaActualizacion">Fecha √∫ltima actualizaci√≥n</label>
                      <input type="date" id="compFechaActualizacion" name="fechaActualizacion" />
                    </div>
                  </div>

                  <!-- HARDWARE -->
                  <div class="subbox" id="compComputadorasBox" style="display:none;">
                    <h3>Datos de hardware ‚Äì Computadoras</h3>
                    <div class="form-grid">
                      <div class="form-group">
                        <label for="compCPU">CPU / Procesador</label>
                        <input type="text" id="compCPU" name="cpu" placeholder="Ej: Intel i5 8¬™ gen" />
                      </div>

                      <div class="form-group">
                        <label for="compRAM">Memoria RAM</label>
                        <input type="text" id="compRAM" name="memoriaRam" placeholder="Ej: 8 GB DDR4" />
                      </div>

                      <div class="form-group">
                        <label for="compSO">Sistema operativo instalado</label>
                        <input type="text" id="compSO" name="sistemaOperativo" placeholder="Ej: Windows 10 Pro, Ubuntu 22.04" />
                      </div>
                    </div>
                  </div>

                  <div class="subbox" id="compPerifericosBox" style="display:none;">
                    <h3>Datos de hardware ‚Äì Perif√©ricos</h3>
                    <div class="form-grid">
                      <div class="form-group">
                        <label for="compDescripcionOtros">Descripci√≥n perif√©rico</label>
                        <input type="text" id="compDescripcionOtros" name="descripcionOtros" placeholder="Ej: Teclado mec√°nico, mouse inal√°mbrico, monitor 24''..." />
                      </div>
                    </div>
                  </div>

                  <div class="subbox" id="compRedBox" style="display:none;">
                    <h3>Datos de hardware ‚Äì Dispositivos de red</h3>
                    <div class="form-grid">
                      <div class="form-group">
                        <label for="compDescripcionRed">Descripci√≥n / caracter√≠sticas</label>
                        <input type="text" id="compDescripcionRed" name="descripcionOtros" placeholder="Ej: Switch 24 puertos, router WiFi AC1200..." />
                      </div>
                    </div>
                  </div>

                  <!-- SOFTWARE -->
                  <div class="subbox" id="compSOBox" style="display:none;">
                    <h3>Sistemas operativos</h3>
                    <div class="form-grid">
                      <div class="form-group">
                        <label for="compTipoSO">Nombre / tipo de SO</label>
                        <input type="text" id="compTipoSO" name="soTipo" placeholder="Ej: Windows 10 Pro, Ubuntu 22.04..." />
                      </div>

                      <div class="form-group">
                        <label for="compVersionSO">Versi√≥n SO</label>
                        <input type="text" id="compVersionSO" name="soVersion" placeholder="Ej: 22H2, 20.04 LTS..." />
                      </div>
                    </div>
                  </div>

                  <div class="subbox" id="compAppsBox" style="display:none;">
                    <h3>Aplicaciones</h3>
                    <div class="form-grid">
                      <div class="form-group">
                        <label for="compAppNombre">Nombre de la aplicaci√≥n</label>
                        <input type="text" id="compAppNombre" name="appNombre" placeholder="Ej: Office 365, Adobe Photoshop..." />
                      </div>

                      <div class="form-group">
                        <label for="compAppVersion">Versi√≥n</label>
                        <input type="text" id="compAppVersion" name="appVersion" placeholder="Ej: 2021, CC 2024..." />
                      </div>

                      <div class="form-group">
                        <label for="compAppFechaInstalacion">Fecha de instalaci√≥n</label>
                        <input type="date" id="compAppFechaInstalacion" name="appFechaInstalacion" />
                      </div>
                    </div>
                  </div>

                  <div class="subbox" id="compLicenciasBox" style="display:none;">
                    <h3>Licencias</h3>
                    <div class="form-grid">
                      <div class="form-group">
                        <label for="compLicenciaTipo">Tipo de licencia</label>
                        <input type="text" id="compLicenciaTipo" name="licenciaTipo" placeholder="Ej: Individual, volumen, suscripci√≥n anual..." />
                      </div>

                      <div class="form-group">
                        <label for="compLicenciaNumero">N¬∞ / clave de licencia</label>
                        <input type="text" id="compLicenciaNumero" name="licenciaNumero" />
                      </div>

                      <div class="form-group">
                        <label for="compLicenciaVencimiento">Fecha de vencimiento</label>
                        <input type="date" id="compLicenciaVencimiento" name="licenciaVencimiento" />
                      </div>
                    </div>
                  </div>

                  <!-- OTROS ACTIVOS -->
                  <div class="subbox" id="compMobiliarioBox" style="display:none;">
                    <h3>Mobiliario</h3>
                    <div class="form-grid">
                      <div class="form-group">
                        <label for="compDescripcionMobiliario">Descripci√≥n mobiliario</label>
                        <input type="text" id="compDescripcionMobiliario" name="descripcionOtros" placeholder="Ej: Mesa para PC, silla ergon√≥mica, estanter√≠a..." />
                      </div>
                    </div>
                  </div>

                  <div class="subbox" id="compHerramientasBox" style="display:none;">
                    <h3>Herramientas / otros activos</h3>
                    <div class="form-grid">
                      <div class="form-group">
                        <label for="compDescripcionHerramientas">Descripci√≥n</label>
                        <input type="text" id="compDescripcionHerramientas" name="descripcionOtros" placeholder="Ej: Kit de herramientas, adaptadores, cables..." />
                      </div>
                    </div>
                  </div>

                  <hr />

                  <h3>Mantenimiento y descripci√≥n general</h3>
                  <div class="form-grid">
                    <div class="form-group">
                      <label for="compMantenimientoNotas">Notas de mantenimiento</label>
                      <textarea id="compMantenimientoNotas" name="mantenimientoNotas" rows="2" placeholder="Historial de mantenciones, reparaciones, observaciones t√©cnicas..."></textarea>
                    </div>

                    <div class="form-group">
                      <label for="compDescripcion">Descripci√≥n general / observaciones</label>
                      <textarea id="compDescripcion" name="descripcion" rows="2" placeholder="Cualquier detalle adicional del equipo o activo..."></textarea>
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="compPhoto">Foto del equipo (opcional)</label>
                    <input type="file" id="compPhoto" name="photo" accept="image/*" />
                  </div>

                  <div class="form-actions">
                    <button type="submit" class="btn-primary">Guardar equipo</button>
                    <button type="reset" class="btn-secondary">Limpiar formulario</button>
                  </div>
                </form>
              </div>
            </div>
          </div>

          <!-- TABLA INVENTARIO COMPUTACI√ìN -->
          <div class="panel-block">
            <div class="collapsible-card" data-collapsed="true">
              <div class="collapsible-header">
                <h3>Inventario de computaci√≥n</h3>
                <button type="button" class="collapse-toggle" aria-expanded="false">
                  <span class="collapse-icon">‚åÑ</span> Mostrar
                </button>
              </div>

              <div class="collapsible-body">
                <div class="filters-row">
                  <label>
                    Buscar
                    <input type="text" id="computingSearch" placeholder="C√≥digo, marca, modelo, ubicaci√≥n..." />
                  </label>

                  <div class="form-actions" style="gap:10px;">
                    <button type="button" id="btnExportComputingCSV" class="btn-secondary">
                      Exportar CSV
                    </button>
                    <button type="button" id="btnExportComputingXLSX" class="btn-secondary">
                      Exportar XLSX
                    </button>
                  </div>
                </div>

                <div class="table-wrapper">
                  <table id="computingTable" class="inventory-table">
                    <thead>
                      <tr>
                        <th>ID</th>
                        <th>ID Equipo</th>
                        <th>C√≥digo</th>
                        <th>Tipo</th>
                        <th>Subtipo</th>
                        <th>Detalle</th>
                        <th>Marca</th>
                        <th>Modelo</th>
                        <th>CPU</th>
                        <th>RAM</th>
                        <th>Sistema operativo</th>
                        <th>Versi√≥n SO / App</th>
                        <th>N¬∞ serie</th>
                        <th>Stock</th>
                        <th>Ubicaci√≥n</th>
                        <th>Estado</th>
                        <th>Fecha compra</th>
                        <th>√öltima actualizaci√≥n</th>
                        <th>Descripci√≥n</th>
                        <th>Foto</th>
                        <th>Acciones</th>
                      </tr>
                    </thead>

                    <tbody id="computingTableBody">
                      <!-- computing.js llenar√° aqu√≠ -->
                    </tbody>
                  </table>
                </div>

                <p class="section-description" style="margin-top:12px;">
                  ‚úÖ El stock baja con pr√©stamos y sube con devoluciones (y queda registrado en historial s√≠ o s√≠).
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- 2) PR√âSTAMOS COMPUTACI√ìN -->
        <div class="panel-grid">
          <div class="panel-block">
            <div class="collapsible-card" data-collapsed="true">
              <div class="collapsible-header">
                <h3>Registrar pr√©stamo de equipo de computaci√≥n</h3>
                <button type="button" class="collapse-toggle" aria-expanded="false">
                  <span class="collapse-icon">‚åÑ</span> Mostrar
                </button>
              </div>

              <div class="collapsible-body">
                <form id="computingLoanForm" class="form-grid">
                  <div class="form-grid">
                    <label>
                      ID del equipo / activo
                      <input type="text" id="computingLoanItemId" name="itemId" placeholder="ID o c√≥digo del inventario" required />
                    </label>

                    <label>
                      Cantidad a prestar
                      <input type="number" id="computingLoanQty" name="cantidad" min="1" value="1" required />
                    </label>

                    <label>
                      Tipo de persona
                      <select id="computingLoanTipoPersona" name="tipoPersona" required>
                        <option value="" selected disabled>Seleccione tipo</option>
                        <option value="estudiante">Estudiante</option>
                        <option value="funcionario">Funcionario</option>
                      </select>
                    </label>
                  </div>

                  <div class="form-grid">
                    <label>
                      Persona
                      <input type="text" id="computingLoanUser" name="persona" placeholder="Nombre completo" required />
                    </label>

                    <label>
                      Curso / Grupo
                      <input type="text" id="computingLoanCurso" name="curso" placeholder="Ej: 2¬∞B, Funcionarios, UTP" />
                    </label>
                  </div>

                  <div class="form-grid">
                    <label>
                      Fecha de pr√©stamo
                      <input type="date" id="computingLoanFecha" name="fechaPrestamo" readonly />
                    </label>

                    <label class="full-width">
                      Observaciones
                      <input type="text" id="computingLoanObs" name="observaciones" placeholder="Ej: Uso en sala 2, hora de clase, proyecto X" />
                    </label>
                  </div>

                  <div class="form-grid">
                    <label class="full-width">
                      Equipo seleccionado
                      <div
                        id="computingLoanItemInfo"
                        class="info-box"
                        style="min-height: 2.5rem; padding: 0.5rem 0; font-size: 0.9rem; opacity: 0.9;"
                      >
                        Escribe el <strong>ID</strong> o el <strong>c√≥digo</strong> del equipo para ver su descripci√≥n,
                        marca, modelo y ubicaci√≥n antes de registrar el pr√©stamo.
                      </div>
                    </label>
                  </div>

                  <div class="form-actions">
                    <button type="submit" class="btn-secondary">Registrar pr√©stamo</button>
                    <button type="button" class="btn-ghost" id="btnComputingReturn" title="Registrar devoluci√≥n por ID de pr√©stamo">
                      Registrar devoluci√≥n
                    </button>
                  </div>

                  <div id="computingReturnInline" class="subbox" style="display:none; margin-top:12px;">
                    <h4>Devoluci√≥n (Computaci√≥n)</h4>
                    <div class="form-grid">
                      <label>
                        ID del pr√©stamo
                        <input type="text" id="computingReturnLoanId" placeholder="Ej: 558" />
                      </label>
                      <label>
                        Cantidad a devolver (opcional)
                        <input type="number" id="computingReturnQty" min="1" placeholder="Si aplica" />
                      </label>
                    </div>
                    <div class="form-actions">
                      <button type="button" id="computingReturnSubmit" class="btn-primary">Confirmar devoluci√≥n</button>
                      <button type="button" id="computingReturnCancel" class="btn-ghost">Cancelar</button>
                    </div>
                  </div>

                </form>
              </div>
            </div>
          </div>

          <div class="panel-block">
            <div class="collapsible-card" data-collapsed="true">
              <div class="collapsible-header">
                <h3>Listado de pr√©stamos de computaci√≥n</h3>
                <button type="button" class="collapse-toggle" aria-expanded="false">
                  <span class="collapse-icon">‚åÑ</span> Mostrar
                </button>
              </div>

              <div class="collapsible-body">
                <div class="table-wrapper">
                  <table id="computingLoanTable" class="inventory-table">
                    <thead>
                      <tr>
                        <th>ID</th>
                        <th>ID Equipo</th>
                        <th>C√≥digo</th>
                        <th>Cantidad</th>
                        <th>Tipo persona</th>
                        <th>Persona</th>
                        <th>Curso / Grupo</th>
                        <th>Fecha pr√©stamo</th>
                        <th>Fecha devoluci√≥n</th>
                        <th>Devuelto</th>
                        <th>Acciones</th>
                      </tr>
                    </thead>

                    <tbody id="computingLoanTableBody">
                      <!-- computing.js llenar√° aqu√≠ -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 3) PENDIENTES / DEUDORES -->
        <div class="panel-grid">
          <div class="panel-block">
            <div class="collapsible-card" data-collapsed="true">
              <div class="collapsible-header">
                <h3>Pr√©stamos vencidos (m√°s de 7 d√≠as)</h3>
                <button type="button" class="collapse-toggle" aria-expanded="false">
                  <span class="collapse-icon">‚åÑ</span> Mostrar
                </button>
              </div>

              <div class="collapsible-body">
                <p>Los pr√©stamos vencidos se destacan autom√°ticamente en la tabla anterior y se listan aqu√≠ abajo.</p>
                <ul id="computingOverdueList" class="list-container"></ul>
              </div>
            </div>
          </div>

          <div class="panel-block">
            <div class="collapsible-card" data-collapsed="true">
              <div class="collapsible-header">
                <h3>Equipos pendientes por devolver</h3>
                <button type="button" class="collapse-toggle" aria-expanded="false">
                  <span class="collapse-icon">‚åÑ</span> Mostrar
                </button>
              </div>

              <div class="collapsible-body">
                <ul id="computingLoanDebtorsList" class="list-container"></ul>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- LIBRARY -->
      <section id="tab-library" class="tab-panel glass-panel" role="region" aria-label="Biblioteca">
        <h2>Inventario ‚Äì Biblioteca</h2>
        <p class="section-description">
          Registra libros, controla stock autom√°ticamente con pr√©stamos/devoluciones y deja historial completo.
        </p>

        <div id="libraryOverdueBanner" class="alert-banner" style="display: none;"></div>

        <div class="panel-grid">
          <div class="panel-block">
            <div class="collapsible-card" data-collapsed="true">
              <div class="collapsible-header">
                <h3>Agregar libro a la biblioteca</h3>
                <button type="button" class="collapse-toggle" aria-expanded="false">
                  <span class="collapse-icon">‚åÑ</span> Mostrar
                </button>
              </div>

              <div class="collapsible-body">
                <form id="libraryForm" enctype="multipart/form-data">
                  <div class="form-grid">
                    <label>
                      C√≥digo
                      <input type="text" name="codigo" required />
                    </label>

                    <label>
                      T√≠tulo
                      <input type="text" name="titulo" required />
                    </label>

                    <label>
                      Autor
                      <input type="text" name="autor" />
                    </label>

                    <label>
                      A√±o
                      <input type="number" name="anio" min="1900" max="2100" />
                    </label>

                    <label>
                      Serie
                      <input type="text" name="serie" />
                    </label>

                    <label>
                      Categor√≠a
                      <select name="categoria" required>
                        <option value="libro">Libro</option>
                        <option value="material escolar">Material Escolar</option>
                        <option value="material multimedia">Material Multimedia</option>
                        <option value="instrumento musical">Instrumento Musical</option>
                        <option value="material did√°ctico">Material Did√°ctico</option>
                        <option value="documento">Documento</option>
                        <option value="otros">Otros</option>
                      </select>
                    </label>

                    <label>
                      Cantidad (stock)
                      <input type="number" name="cantidad" min="0" required />
                    </label>

                    <label>
                      Descripci√≥n
                      <input type="text" name="descripcion" />
                    </label>

                    <label>
                      Foto
                      <input type="file" name="photo" accept="image/*" />
                    </label>
                  </div>

                  <button type="submit" class="btn-primary">Guardar libro</button>
                </form>
              </div>
            </div>
          </div>

          <div class="panel-block">
            <div class="collapsible-card" data-collapsed="true">
              <div class="collapsible-header">
                <h3>Listado de libros</h3>
                <button type="button" class="collapse-toggle" aria-expanded="false">
                  <span class="collapse-icon">‚åÑ</span> Mostrar
                </button>
              </div>

              <div class="collapsible-body">
                <div class="filters-row" data-library-filters="container">
                  <div class="filters-group" data-library-filters="simple" style="display: flex;">
                    <label>
                      Buscar
                      <input type="text" id="librarySearch" placeholder="C√≥digo, t√≠tulo, autor, categor√≠a..." />
                    </label>
                  </div>

                  <div class="filters-group" data-library-filters="advanced" style="display: none;">
                    <label>
                      Categor√≠a
                      <select id="libraryFilterCategoria">
                        <option value="all">Todas</option>
                        <option value="libro">Libro</option>
                        <option value="material escolar">Material Escolar</option>
                        <option value="material multimedia">Material Multimedia</option>
                        <option value="instrumento musical">Instrumento Musical</option>
                        <option value="material did√°ctico">Material Did√°ctico</option>
                        <option value="documento">Documento</option>
                        <option value="otros">Otros</option>
                      </select>
                    </label>

                    <label>
                      A√±o desde
                      <input type="number" id="libraryFilterYearFrom" min="1900" max="2100" />
                    </label>

                    <label>
                      A√±o hasta
                      <input type="number" id="libraryFilterYearTo" min="1900" max="2100" />
                    </label>

                    <label class="checkbox-inline">
                      <input type="checkbox" id="libraryFilterHasPhoto" />
                      Solo con foto
                    </label>
                  </div>

                  <div class="filters-mode">
                    <label>
                      Modo filtros
                      <select id="libraryFilterMode">
                        <option value="simple">B√∫squeda simple</option>
                        <option value="advanced">Solo avanzados</option>
                        <option value="both" selected>Ambos</option>
                      </select>
                    </label>
                  </div>

                  <div class="form-actions" style="gap:10px;">
                    <button type="button" id="btnExportLibraryCSV" class="btn-secondary">Exportar CSV</button>
                    <button type="button" id="btnExportLibraryXLSX" class="btn-secondary">Exportar XLSX</button>
                  </div>
                </div>

                <div class="table-wrapper">
                  <table id="libraryTable" class="inventory-table">
                    <thead>
                      <tr>
                        <th>ID</th>
                        <th>C√≥digo</th>
                        <th>T√≠tulo</th>
                        <th>Autor</th>
                        <th>A√±o</th>
                        <th>Serie</th>
                        <th>Categor√≠a</th>
                        <th>Stock</th>
                        <th>Descripci√≥n</th>
                        <th>Foto</th>
                        <th>Acciones</th>
                      </tr>
                    </thead>
                    <tbody>
                      <!-- library.js llenar√° aqu√≠ -->
                    </tbody>
                  </table>
                </div>

                <p class="section-description" style="margin-top:12px;">
                  ‚úÖ Stock autom√°tico: baja con pr√©stamo, sube con devoluci√≥n, y queda registro en historial.
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Pr√©stamos -->
        <div class="panel-grid">
          <div class="panel-block">
            <div class="collapsible-card" data-collapsed="true">
              <div class="collapsible-header">
                <h3>Registrar pr√©stamo</h3>
                <button type="button" class="collapse-toggle" aria-expanded="false">
                  <span class="collapse-icon">‚åÑ</span> Mostrar
                </button>
              </div>

              <div class="collapsible-body">
                <form id="loanForm">
                  <div class="form-grid">
                    <label>
                      C√≥digo del libro
                      <input type="text" name="codigo" required />
                    </label>

                    <label>
                      Estudiante / Funcionario
                      <select name="personaId" id="loanPersonaSelect">
                        <option value="">Escribe o selecciona una persona</option>
                      </select>
                    </label>

                    <label>
                      Nombre de quien pide
                      <input type="text" name="nombre" id="loanNombre" required />
                    </label>

                    <label>
                      Curso / Funcionario
                      <input type="text" name="curso" id="loanCurso" />
                    </label>

                    <input type="hidden" name="tipoPersona" id="loanTipoPersona" />

                    <label class="full-width">
                      Observaciones
                      <input type="text" name="observaciones" />
                    </label>
                  </div>

                  <button type="submit" class="btn-secondary">Registrar pr√©stamo</button>
                </form>
              </div>
            </div>
          </div>

          <div class="panel-block">
            <div class="collapsible-card" data-collapsed="true">
              <div class="collapsible-header">
                <h3>Registrar devoluci√≥n</h3>
                <button type="button" class="collapse-toggle" aria-expanded="false">
                  <span class="collapse-icon">‚åÑ</span> Mostrar
                </button>
              </div>

              <div class="collapsible-body">
                <form id="returnForm">
                  <div class="form-grid">
                    <label>
                      ID del pr√©stamo
                      <input type="text" name="loanId" required />
                    </label>
                  </div>

                  <button type="submit" class="btn-ghost">Registrar devoluci√≥n</button>
                </form>
              </div>
            </div>
          </div>
        </div>

        <!-- Listado de pr√©stamos -->
        <div class="panel-block">
          <div class="collapsible-card" data-collapsed="true">
            <div class="collapsible-header">
              <h3>Listado de pr√©stamos</h3>
              <button type="button" class="collapse-toggle" aria-expanded="false">
                <span class="collapse-icon">‚åÑ</span> Mostrar
              </button>
            </div>

            <div class="collapsible-body">
              <div class="filters-row" data-loans-filters="container">
                <div class="filters-group" data-loans-filters="simple" style="display: flex;">
                  <label>
                    Buscar
                    <input type="text" id="loansSearch" placeholder="ID, c√≥digo, nombre, curso..." />
                  </label>
                </div>

                <div class="filters-group" data-loans-filters="advanced" style="display: none;">
                  <label>
                    Estado
                    <select id="loansFilterReturned">
                      <option value="all">Todos</option>
                      <option value="yes">Solo devueltos</option>
                      <option value="no">Solo pendientes</option>
                    </select>
                  </label>

                  <label>
                    Desde
                    <input type="date" id="loansFilterDateFrom" />
                  </label>

                  <label>
                    Hasta
                    <input type="date" id="loansFilterDateTo" />
                  </label>
                </div>

                <div class="filters-mode">
                  <label>
                    Modo filtros
                    <select id="loansFilterMode">
                      <option value="simple">B√∫squeda simple</option>
                      <option value="advanced">Solo avanzados</option>
                      <option value="both" selected>Ambos</option>
                    </select>
                  </label>
                </div>

                <div class="form-actions" style="gap:10px;">
                  <button type="button" id="btnExportLoansXLSX" class="btn-secondary">Exportar XLSX</button>
                  <button type="button" id="btnExportLoansPDF" class="btn-secondary">Exportar PDF</button>
                </div>
              </div>

              <div class="table-wrapper">
                <table id="loansTable" class="inventory-table">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>C√≥digo libro</th>
                      <th>Nombre quien pide</th>
                      <th>Curso / Funcionario</th>
                      <th>Fecha pr√©stamo</th>
                      <th>Devuelto</th>
                      <th>Fecha devoluci√≥n</th>
                      <th>Observaciones</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- library.js llenar√° aqu√≠ -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Personas -->
        <div class="panel-grid">
          <div class="panel-block">
            <div class="collapsible-card" data-collapsed="true">
              <div class="collapsible-header">
                <h3>Personas registradas (Estudiantes / Funcionarios)</h3>
                <button type="button" class="collapse-toggle" aria-expanded="false">
                  <span class="collapse-icon">‚åÑ</span> Mostrar
                </button>
              </div>

              <div class="collapsible-body">
                <form id="peopleForm">
                  <div class="form-grid">
                    <label>
                      ID
                      <input type="text" name="id" placeholder="Ej: STU-001, FUNC-001" />
                    </label>

                    <label>
                      Nombre completo
                      <input type="text" name="nombre" required />
                    </label>

                    <label>
                      Tipo
                      <select name="tipo" required>
                        <option value="estudiante">Estudiante</option>
                        <option value="funcionario">Funcionario</option>
                      </select>
                    </label>

                    <label>
                      Curso / Cargo
                      <input type="text" name="curso" placeholder="Ej: 7¬∞A, Inspector√≠a" />
                    </label>
                  </div>

                  <div class="form-actions">
                    <button type="submit" class="btn-secondary" id="peopleFormSubmit">Guardar persona</button>
                    <button type="button" class="btn-ghost" id="peopleFormCancel" style="display: none;">Cancelar edici√≥n</button>
                  </div>
                </form>
              </div>
            </div>
          </div>

          <div class="panel-block">
            <div class="collapsible-card" data-collapsed="true">
              <div class="collapsible-header">
                <h3>Listado de personas</h3>
                <button type="button" class="collapse-toggle" aria-expanded="false">
                  <span class="collapse-icon">‚åÑ</span> Mostrar
                </button>
              </div>

              <div class="collapsible-body">
                <div class="table-wrapper">
                  <table id="peopleTable" class="inventory-table">
                    <thead>
                      <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Tipo</th>
                        <th>Curso / Cargo</th>
                        <th>Acciones</th>
                      </tr>
                    </thead>
                    <tbody>
                      <!-- library.js llenar√° aqu√≠ -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>

      </section>

      <!-- RESERVAS (TABLA + VALIDACI√ìN CHOQUES) -->
      <section id="tab-reservations" class="tab-panel glass-panel" role="region" aria-label="Reservas">
        <h2>Reservas (todas las salas / m√≥dulos)</h2>
        <p class="section-description">
          Agenda y revisa reservas en una tabla √∫nica. El sistema valida choques (misma fecha/horario superpuesto)
          y deja registro en historial s√≠ o s√≠.
        </p>

        <div class="panel-grid">
          <!-- Formulario reserva general -->
          <div class="panel-block">
            <div class="collapsible-card" data-collapsed="true" id="reservations-card-form">
              <div class="collapsible-header">
                <h3>Nueva reserva</h3>
                <button type="button" class="collapse-toggle" aria-expanded="false">
                  <span class="collapse-icon">‚åÑ</span> Mostrar
                </button>
              </div>

              <div class="collapsible-body">
                <form id="reservationForm">
                  <div class="form-grid">
                    <label>
                      M√≥dulo
                      <select name="module" required>
                        <option value="" disabled selected>Seleccionar...</option>
                        <option value="science">Laboratorio de Ciencias</option>
                        <option value="computing">Sala de Computaci√≥n</option>
                        <option value="library">Biblioteca</option>
                        <option value="other">Otro espacio</option>
                      </select>
                    </label>

                    <label>
                      Espacio / sala
                      <input type="text" name="space" placeholder="Ej: Lab 1, Sala Computaci√≥n, Biblioteca..." required />
                    </label>

                    <label>
                      Solicitante
                      <input type="text" name="solicitante" required />
                    </label>

                    <label>
                      Curso / Grupo
                      <input type="text" name="curso" placeholder="Ej: 2¬∞B, UTP, Taller..." />
                    </label>

                    <label>
                      Fecha
                      <input type="date" name="date" required />
                    </label>

                    <label>
                      Hora inicio
                      <input type="time" name="start" required />
                    </label>

                    <label>
                      Hora t√©rmino
                      <input type="time" name="end" required />
                    </label>

                    <label class="full-width">
                      Recursos (opcional)
                      <input type="text" name="recursos" placeholder="Ej: proyectores, kits, materiales..." />
                    </label>

                    <label class="full-width">
                      Observaciones
                      <input type="text" name="observaciones" />
                    </label>
                  </div>

                  <div class="form-actions">
                    <button type="submit" class="btn-primary">Guardar reserva</button>
                    <button type="reset" class="btn-secondary">Limpiar</button>
                  </div>

                  <div id="reservationStatus" class="info-box" style="margin-top:12px; display:none;"></div>
                </form>
              </div>
            </div>
          </div>

          <!-- Tabla reservas -->
          <div class="panel-block">
            <div class="collapsible-card" data-collapsed="true" id="reservations-card-table">
              <div class="collapsible-header">
                <h3>Tabla de reservas</h3>
                <button type="button" class="collapse-toggle" aria-expanded="false">
                  <span class="collapse-icon">‚åÑ</span> Mostrar
                </button>
              </div>

              <div class="collapsible-body">
                <div class="filters-row">
                  <label>
                    Buscar
                    <input type="text" id="reservationsSearch" placeholder="Sala, solicitante, curso, fecha..." />
                  </label>

                  <label>
                    M√≥dulo
                    <select id="reservationsModuleFilter">
                      <option value="all" selected>Todos</option>
                      <option value="science">Ciencias</option>
                      <option value="computing">Computaci√≥n</option>
                      <option value="library">Biblioteca</option>
                      <option value="other">Otros</option>
                    </select>
                  </label>

                  <div class="form-actions" style="gap:10px;">
                    <button type="button" id="btnExportReservationsXLSX" class="btn-secondary">Exportar XLSX</button>
                    <button type="button" id="btnExportReservationsPDF" class="btn-secondary">Exportar PDF</button>
                  </div>
                </div>

                <div class="table-wrapper">
                  <table id="reservationsTable" class="inventory-table">
                    <thead>
                      <tr>
                        <th>ID</th>
                        <th>M√≥dulo</th>
                        <th>Espacio</th>
                        <th>Solicitante</th>
                        <th>Curso/Grupo</th>
                        <th>Fecha</th>
                        <th>Inicio</th>
                        <th>T√©rmino</th>
                        <th>Recursos</th>
                        <th>Obs.</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                      </tr>
                    </thead>
                    <tbody>
                      <!-- reservations.js llenar√° aqu√≠ -->
                    </tbody>
                  </table>
                </div>

                <p class="section-description" style="margin-top:12px;">
                  ‚úÖ Validaci√≥n anti-choques: el sistema bloquea reservas superpuestas en el mismo espacio/fecha.
                </p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- HISTORIAL + REPORTES -->
      <section id="tab-history" class="tab-panel glass-panel" role="region" aria-label="Historial">
        <h2>Historial + Reportes</h2>
        <p class="section-description">
          Historial ‚Äúbonito y √∫til‚Äù con todo lo necesario: movimientos, pr√©stamos/devoluciones (con impacto en stock),
          reservas (con validaci√≥n de choques), y reportes para Direcci√≥n / UTP (pantalla + PDF/XLSX).
        </p>

        <!-- CONTROLES DE REPORTE -->
        <div class="panel-block">
          <div class="collapsible-card" data-collapsed="true" id="reports-card-controls">
            <div class="collapsible-header">
              <h3>Reportes (Direcci√≥n / UTP)</h3>
              <button type="button" class="collapse-toggle" aria-expanded="false">
                <span class="collapse-icon">‚åÑ</span> Mostrar
              </button>
            </div>

            <div class="collapsible-body">
              <div class="filters-row">
                <label>
                  Per√≠odo
                  <select id="reportRange">
                    <option value="7">√öltimos 7 d√≠as</option>
                    <option value="30" selected>√öltimos 30 d√≠as</option>
                    <option value="90">√öltimos 90 d√≠as</option>
                    <option value="365">√öltimo a√±o</option>
                    <option value="custom">Personalizado</option>
                  </select>
                </label>

                <label>
                  Desde
                  <input type="date" id="reportFrom" />
                </label>

                <label>
                  Hasta
                  <input type="date" id="reportTo" />
                </label>

                <label>
                  M√≥dulo
                  <select id="reportModule">
                    <option value="all" selected>Todos</option>
                    <option value="science">Ciencias</option>
                    <option value="computing">Computaci√≥n</option>
                    <option value="library">Biblioteca</option>
                    <option value="reservations">Reservas</option>
                  </select>
                </label>

                <div class="form-actions" style="gap:10px;">
                  <button type="button" id="btnRunReport" class="btn-primary">Generar reporte</button>
                  <button type="button" id="btnExportReportPDF" class="btn-secondary">Descargar PDF</button>
                  <button type="button" id="btnExportReportXLSX" class="btn-secondary">Descargar XLSX</button>
                </div>
              </div>

              <div id="reportStatus" class="info-box" style="margin-top:12px; display:none;"></div>
            </div>
          </div>
        </div>

        <!-- HISTORIAL TABLA (BONITO + FILTROS) -->
        <div class="panel-block">
          <div class="collapsible-card" data-collapsed="true" id="history-card-table">
            <div class="collapsible-header">
              <h3>Historial del sistema (auditor√≠a completa)</h3>
              <button type="button" class="collapse-toggle" aria-expanded="false">
                <span class="collapse-icon">‚åÑ</span> Mostrar
              </button>
            </div>

            <div class="collapsible-body">
              <div class="filters-row">
                <label>
                  M√≥dulo
                  <select id="historyLabFilter">
                    <option value="all">Todos los m√≥dulos</option>
                    <option value="science">Laboratorio de Ciencias</option>
                    <option value="computing">Sala de Computaci√≥n</option>
                    <option value="library">Biblioteca</option>
                    <option value="reservations">Reservas</option>
                  </select>
                </label>

                <label>
                  Tipo de acci√≥n
                  <select id="historyActionFilter">
                    <option value="all" selected>Todas</option>
                    <option value="create">Ingreso/Creaci√≥n</option>
                    <option value="update">Edici√≥n</option>
                    <option value="delete">Eliminaci√≥n</option>
                    <option value="loan">Pr√©stamo</option>
                    <option value="return">Devoluci√≥n</option>
                    <option value="reserve">Reserva</option>
                    <option value="cancel_reserve">Cancelaci√≥n reserva</option>
                  </select>
                </label>

                <label>
                  Buscar
                  <input type="text" id="historySearch" placeholder="C√≥digo, persona, curso, detalle..." />
                </label>

                <label>
                  Cantidad de registros
                  <select id="historyLimit">
                    <option value="50">√öltimos 50</option>
                    <option value="100" selected>√öltimos 100</option>
                    <option value="200">√öltimos 200</option>
                    <option value="500">√öltimos 500</option>
                  </select>
                </label>

                <div class="form-actions" style="gap:10px;">
                  <button type="button" id="btnExportHistoryPDF" class="btn-secondary">PDF</button>
                  <button type="button" id="btnExportHistoryXLSX" class="btn-secondary">XLSX</button>
                </div>
              </div>

              <div class="table-wrapper">
                <table id="historyTable" class="inventory-table">
                  <thead>
                    <tr>
                      <th>Fecha</th>
                      <th>M√≥dulo</th>
                      <th>Acci√≥n</th>
                      <th>Tipo</th>
                      <th>ID entidad</th>
                      <th>C√≥digo</th>
                      <th>Usuario</th>
                      <th>Tipo persona</th>
                      <th>Curso / Sala</th>
                      <th>Cantidad</th>
                      <th>Stock antes</th>
                      <th>Stock despu√©s</th>
                      <th>Detalle</th>
                      <th>IP/Dispositivo</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- history.js llenar√° aqu√≠ -->
                  </tbody>
                </table>
              </div>

              <p class="section-description" style="margin-top:12px;">
                ‚úÖ Este historial es el ‚Äúlibro‚Äù del sistema: todo movimiento se guarda aqu√≠ (s√≠ o s√≠).
              </p>
            </div>
          </div>
        </div>

        <!-- AN√ÅLISIS DE DATOS (SUBDIVIDIDO EN CUADROS / VENTANAS) -->
        <div class="panel-grid">

          <!-- 1) RESUMEN -->
          <div class="panel-block">
            <div class="collapsible-card" data-collapsed="true" id="analytics-card-summary" data-analytics-section="summary">
              <div class="collapsible-header">
                <h3>An√°lisis ‚Äì Resumen r√°pido</h3>
                <button type="button" class="collapse-toggle" aria-expanded="false">
                  <span class="collapse-icon">‚åÑ</span> Mostrar
                </button>
              </div>

              <div class="collapsible-body">
                <div class="analytics-summary-grid">
                  <div class="analytics-card">
                    <span class="analytics-label">Total pr√©stamos</span>
                    <span id="analyticsTotalLoans" class="analytics-value">0</span>
                  </div>
                  <div class="analytics-card">
                    <span class="analytics-label">Pr√©stamos a estudiantes</span>
                    <span id="analyticsStudentLoans" class="analytics-value">0</span>
                  </div>
                  <div class="analytics-card">
                    <span class="analytics-label">Pr√©stamos a funcionarios</span>
                    <span id="analyticsStaffLoans" class="analytics-value">0</span>
                  </div>
                  <div class="analytics-card">
                    <span class="analytics-label">Promedio d√≠as pr√©stamo</span>
                    <span id="analyticsAvgLoanDays" class="analytics-value">0</span>
                  </div>
                  <div class="analytics-card">
                    <span class="analytics-label">Sala / curso m√°s activo</span>
                    <span id="analyticsTopRoom" class="analytics-value">‚Äî</span>
                  </div>
                  <div class="analytics-card">
                    <span class="analytics-label">M√≥dulo con m√°s movimientos</span>
                    <span id="analyticsTopModule" class="analytics-value">‚Äî</span>
                  </div>
                </div>

                <div class="analytics-narrative" id="analyticsNarrativeSummary" aria-live="polite">
                  <p class="section-description" style="margin-top: 14px;">
                    Aqu√≠ ver√°s el resumen global calculado desde historial y pr√©stamos (incluye reservas).
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- 2) DONUT: TIPO DE PERSONA -->
          <div class="panel-block">
            <div class="collapsible-card" data-collapsed="true" id="analytics-card-person" data-analytics-section="personType">
              <div class="collapsible-header">
                <h3>An√°lisis ‚Äì Pr√©stamos por tipo de persona</h3>
                <button type="button" class="collapse-toggle" aria-expanded="false">
                  <span class="collapse-icon">‚åÑ</span> Mostrar
                </button>
              </div>

              <div class="collapsible-body">
                <div class="chart-card">
                  <h4>Distribuci√≥n (Estudiante / Funcionario / Desconocido)</h4>
                  <canvas id="chartLoansByPersonType"></canvas>
                </div>

                <div class="analytics-narrative" id="analyticsNarrativePersonType" aria-live="polite">
                  <p class="section-description">
                    Interpretaci√≥n: muestra qu√© grupo usa m√°s recursos. ‚ÄúDesconocido‚Äù sugiere mejorar registro.
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- 3) USO POR SALA / CURSO -->
          <div class="panel-block">
            <div class="collapsible-card" data-collapsed="true" id="analytics-card-room" data-analytics-section="roomUsage">
              <div class="collapsible-header">
                <h3>An√°lisis ‚Äì Uso por sala / curso</h3>
                <button type="button" class="collapse-toggle" aria-expanded="false">
                  <span class="collapse-icon">‚åÑ</span> Mostrar
                </button>
              </div>

              <div class="collapsible-body">
                <div class="chart-card">
                  <h4>Salas / cursos con m√°s actividad</h4>
                  <canvas id="chartLoansByRoom"></canvas>
                </div>

                <div class="analytics-narrative" id="analyticsNarrativeRoom" aria-live="polite">
                  <p class="section-description">
                    Identifica grupos con mayor uso para reposici√≥n, mantenci√≥n y planificaci√≥n.
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- 4) DURACI√ìN DE PR√âSTAMOS -->
          <div class="panel-block">
            <div class="collapsible-card" data-collapsed="true" id="analytics-card-duration" data-analytics-section="duration">
              <div class="collapsible-header">
                <h3>An√°lisis ‚Äì Duraci√≥n de pr√©stamos</h3>
                <button type="button" class="collapse-toggle" aria-expanded="false">
                  <span class="collapse-icon">‚åÑ</span> Mostrar
                </button>
              </div>

              <div class="collapsible-body">
                <div class="chart-card">
                  <h4>Distribuci√≥n de d√≠as (demora en devoluci√≥n)</h4>
                  <canvas id="chartLoanDuration"></canvas>
                </div>

                <div class="analytics-narrative" id="analyticsNarrativeDuration" aria-live="polite">
                  <p class="section-description">
                    Si la mayor√≠a cae en rangos altos, reforzar reglas y alertas autom√°ticas.
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- 5) MOVIMIENTOS POR M√ìDULO -->
          <div class="panel-block">
            <div class="collapsible-card" data-collapsed="true" id="analytics-card-module" data-analytics-section="moduleMoves">
              <div class="collapsible-header">
                <h3>An√°lisis ‚Äì Movimientos por m√≥dulo</h3>
                <button type="button" class="collapse-toggle" aria-expanded="false">
                  <span class="collapse-icon">‚åÑ</span> Mostrar
                </button>
              </div>

              <div class="collapsible-body">
                <div class="chart-card">
                  <h4>Actividad por m√≥dulo (incluye reservas)</h4>
                  <canvas id="chartHistoryByModule"></canvas>
                </div>

                <div class="analytics-narrative" id="analyticsNarrativeModule" aria-live="polite">
                  <p class="section-description">
                    Ayuda a detectar m√≥dulos con m√°s carga de gesti√≥n.
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- 6) PANEL ‚ÄúEXPLICACI√ìN IA‚Äù -->
          <div class="panel-block">
            <div class="collapsible-card" data-collapsed="true" id="analytics-card-ai" data-analytics-section="ai">
              <div class="collapsible-header">
                <h3>Asistente ‚Äì Explicaci√≥n autom√°tica</h3>
                <button type="button" class="collapse-toggle" aria-expanded="false">
                  <span class="collapse-icon">‚åÑ</span> Mostrar
                </button>
              </div>

              <div class="collapsible-body">
                <p class="section-description">
                  Cuadro listo para generar una explicaci√≥n estilo informe desde los datos del reporte/historial.
                </p>

                <div id="analyticsAIReport" class="info-box" style="min-height: 90px;">
                  <strong>Informe:</strong> (pendiente) ‚Äî aqu√≠ aparecer√° un resumen autom√°tico cuando lo implementemos.
                </div>

                <div class="form-actions" style="margin-top: 12px;">
                  <button type="button" id="btnGenerateAIReport" class="btn-secondary">Generar informe (pr√≥ximamente)</button>
                  <button type="button" id="btnCopyAIReport" class="btn-ghost">Copiar</button>
                </div>
              </div>
            </div>
          </div>

        </div>

      </section>

    </main>
  </div>

  <!-- IMPORTANTE: orden de scripts -->
  <!-- 1) Base global: estrellas / helpers -->
  <script src="/script.js" defer></script>

  <!-- 2) Seguridad de roles + guardedFetch -->
  <script src="/js/roleGuard.js" defer></script>

  <!-- 3) UI -->
  <script src="/js/tabs.js" defer></script>
  <script src="/js/collapsibles.js" defer></script>

  <!-- 4) M√≥dulos -->
  <script src="/js/science.js" defer></script>
  <script src="/js/computing.js" defer></script>
  <script src="/js/library.js" defer></script>

  <!-- ‚úÖ NUEVO: reservas globales (tabla + validaci√≥n choques) -->
  <script src="/js/reservations.js" defer></script>

  <!-- ‚úÖ Historial + reportes + analytics + export PDF/XLSX -->
  <script src="/js/history.js" defer></script>
  <script src="/js/reports.js" defer></script>
</body>
</html>
